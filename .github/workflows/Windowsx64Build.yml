name: RustDesk CI

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'æ„å»ºåˆ†æ”¯'
        required: true
        default: 'master'
        type: choice
        options: [master, dev]

env:
  FLUTTER_VERSION: "3.29.3"
  PROJECT_ROOT: "."  # ä¿®å¤è·¯å¾„å±‚çº§é—®é¢˜
  FFIGEN_VERSION: "6.1.2"
  BUILD_DIR: "build/windows/runner/Release"

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
    # æ­¥éª¤é¡ºåºå¿…é¡»ä¸¥æ ¼å¦‚ä¸‹ â–¼
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ğŸš€ ä¼˜å…ˆå®‰è£…Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: "3.29.3"
        channel: stable
        architecture: x64
      env:
        PUB_CACHE: "${{ github.workspace }}/.pub_cache"  # æ˜¾å¼è®¾ç½®ç¼“å­˜è·¯å¾„

    - name: âš™ï¸ é…ç½®Flutterç¯å¢ƒ
      shell: pwsh
      run: |
        # å¼ºåˆ¶åˆ·æ–°PATH
        $env:Path += ";$env:FLUTTER_HOME\bin"
        flutter config --disable-telemetry
        flutter doctor -v

    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        flutter pub get --verbose
